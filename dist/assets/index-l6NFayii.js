(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();const P=window.PIXI,f=1408;let F=704;const{innerWidth:_,innerHeight:N}=window;N>_*1.3&&(F=f*_/N,F<320&&(F=320));const d=F,a=35,L=1/120,I=10,W=10,h=[{name:"/madeWatermelon/fruits/fruit_1.png",radius:26,imgRadius:26},{name:"/madeWatermelon/fruits/fruit_2.png",radius:39,imgRadius:39},{name:"/madeWatermelon/fruits/fruit_3.png",radius:54,imgRadius:54},{name:"/madeWatermelon/fruits/fruit_4.png",radius:59.5,imgRadius:59.5},{name:"/madeWatermelon/fruits/fruit_5.png",radius:76,imgRadius:76},{name:"/madeWatermelon/fruits/fruit_6.png",radius:91.5,imgRadius:91.5},{name:"/madeWatermelon/fruits/fruit_7.png",radius:100,imgRadius:93},{name:"/madeWatermelon/fruits/fruit_8.png",radius:115,imgRadius:129},{name:"/madeWatermelon/fruits/fruit_9.png",radius:130,imgRadius:154},{name:"/madeWatermelon/fruits/fruit_10.png",radius:140,imgRadius:151},{name:"/madeWatermelon/fruits/fruit_11.png",radius:150,imgRadius:202}],x=new P.Application({width:d,height:f,antialias:!0,backgroundColor:16771229}),l=window.b2,{Sprite:j,Loader:C}=P,p=new l.World({x:0,y:10}),k=()=>{const o=new l.BodyDef,t=new l.FixtureDef;o.type=l.staticBody,t.density=0,t.friction=.2,t.restitution=.3,t.filter.groupIndex=-20,t.shape=new l.ChainShape().CreateLoop([{x:0,y:0/a},{x:0,y:f/a},{x:d/a,y:f/a},{x:d/a,y:0/a}]);const e=p.CreateBody(o);e.CreateFixture(t),e.SetUserData({type:-1})},O=150/a,G=new l.BodyDef;G.type=l.dynamicBody;G.position.Set(d/2/a,O);const M=h.map((o,t)=>{const e=new l.FixtureDef;return e.density=.1,e.friction=.2,e.restitution=.3,e.shape=new l.CircleShape(o.radius/a),e.filter.groupIndex=1,e});let y=0;const c={},S=new Map,g=new Set,D=(o,t=-299,e=-299)=>{const n=h[o],r=new j;return r.anchor.set(.5),r.x=t,r.y=e,r.texture=C.shared.resources[n.name].texture,r.scale.set(n.radius/n.imgRadius),r},s={current:0,next:0};let m,E;const q=()=>{let o=0,t=0;Object.defineProperty(s,"current",{get(){return o},set(e){o=e;const n=h[e];m.texture=C.shared.resources[n.name].texture,m.scale.set(n.radius/n.imgRadius)}}),Object.defineProperty(s,"next",{get(){return t},set(e){t=e;const n=h[e];E.texture=C.shared.resources[n.name].texture,E.scale.set(n.radius/n.imgRadius)}})};q();const X=(o,t=d/2)=>{let e=t;t<5&&(e=5),t>d-5&&(e=d-5);const n=p.CreateBody(G);n.SetSleepingAllowed(!0),n.SetPositionXY(e/a,O),n.CreateFixture(M[o]),n.SetUserData({type:o,id:y});const r=D(o);x.stage.addChild(r),c[y++]={body:n,sprite:r},s.current=s.next,y<4?s.next=Math.floor(Math.random()*2):y<8?s.next=Math.floor(Math.random()*3):y<16?s.next=Math.round(Math.random()*3.5):s.next=Math.round(Math.random()*4)},R=()=>{S.forEach((o,t)=>{let e=c[o],n=c[t];if(e.body.GetPosition().y>n.body.GetPosition().y){const u=e;e=n,n=u}n.body.DestroyFixture(n.body.GetFixtureList());const r=n.body.GetUserData();n.body.CreateFixture(M[r.type+1]),n.body.SetUserData({...r,type:r.type+1}),g.delete(t),g.delete(o),delete c[e.body.GetUserData().id],p.DestroyBody(e.body),x.stage.removeChild(e.sprite);const i=h[r.type+1];n.sprite.texture=C.shared.resources[i.name].texture,n.sprite.scale.set(i.radius/i.imgRadius)}),S.clear()},U=()=>{p.Step(L,I,W),R(),p.Step(L,I,W),R(),p.Step(L,I,W),R(),Object.keys(c).forEach(o=>{const t=c[o],{body:e,sprite:n}=t,{x:r,y:i}=e.GetPosition(),u=e.GetAngle();n.x=r*a,n.y=i*a,n.rotation=u}),requestAnimationFrame(U)},B=document.getElementById("root");let $=0;const A=()=>{const o=new Date().getTime();return o-$<100?!0:($=o,!1)},H=()=>{const o=document.getElementsByTagName("canvas")[0];o.addEventListener("touchmove",t=>{const{changedTouches:e}=t;if(e.length!==1)return;const n=parseFloat(getComputedStyle(B).marginLeft),{clientX:r}=e[0],i=(r-n)/parseFloat(B.childNodes[0].style.transform.slice(6));m.x=i}),o.addEventListener("touchend",t=>{if(A())return;const{changedTouches:e}=t;if(e.length!==1)return;const n=parseFloat(getComputedStyle(B).marginLeft),{clientX:r}=e[0],i=(r-n)/parseFloat(B.childNodes[0].style.transform.slice(6));m.x=d/2,X(s.current,i)}),o.addEventListener("mousemove",t=>{if("ontouchend"in window)return;const{offsetX:e}=t;m.x=e}),o.addEventListener("click",t=>{if("ontouchend"in window||A())return;const{offsetX:e}=t;m.x=e,X(s.current,e)}),k(),m=D(s.current,d/2,O*a),E=D(s.next,d/2,0),x.stage.addChild(m),x.stage.addChild(E),l.ContactListener.prototype.PreSolve=t=>{const e=t.GetFixtureA().GetBody().GetUserData(),n=t.GetFixtureB().GetBody().GetUserData();if(e.type!==n.type||e.type>=10)return;const r=Math.min(e.id,n.id),i=Math.max(e.id,n.id),u=S.get(r);if(!u){if(g.has(r)||g.has(i))return;S.set(r,i),g.add(r),g.add(i),t.SetEnabled(!1);return}u===i&&t.SetEnabled(!1)},U()},Y=()=>{const o={fruits:Object.keys(c).map(t=>{const e=c[t],n=e.body.GetPosition();return{id:parseInt(t),type:e.body.GetUserData().type,x:n.x,y:n.y,angle:e.body.GetAngle()}}),fruitId:y,currentFruit:s.current,nextFruit:s.next};localStorage.setItem("watermelonGame",JSON.stringify(o))},z=()=>{const o=localStorage.getItem("watermelonGame");if(o)try{const t=JSON.parse(o);v(),t.fruits.forEach(e=>{const n=h[e.type],r=p.CreateBody(G);r.SetSleepingAllowed(!0),r.SetPositionXY(e.x,e.y),r.SetAngle(e.angle),r.CreateFixture(M[e.type]),r.SetUserData({type:e.type,id:e.id});const i=D(e.type);i.x=e.x*a,i.y=e.y*a,i.rotation=e.angle,x.stage.addChild(i),c[e.id]={body:r,sprite:i}}),y=t.fruitId,s.current=t.currentFruit,s.next=t.nextFruit}catch(t){console.error("加载游戏失败:",t)}},v=()=>{Object.keys(c).forEach(o=>{const t=c[o];p.DestroyBody(t.body),x.stage.removeChild(t.sprite),delete c[o]}),S.clear(),g.clear(),y=0,s.current=0,s.next=0},{Loader:J}=P,K=h.map(o=>o.name),w=document.getElementById("root"),b=x.view;w.appendChild(b);J.shared.add(K).load(H);const T=()=>{const{innerWidth:o,innerHeight:t}=window;document.body.style.height=`${t}px`,o/t>d/f?(w.style.height=`${t}px`,w.style.width=`${t/f*d}px`,b.style.transform=`scale(${t/f})`):(w.style.width=`${o}px`,w.style.height=`${o/d*f}px`,b.style.transform=`scale(${o/d})`)};b.style.width=`${d}px`;b.style.height=`${f}px`;T();window.onresize=T;document.getElementById("saveBtn")?.addEventListener("click",Y);document.getElementById("loadBtn")?.addEventListener("click",z);document.getElementById("clearBtn")?.addEventListener("click",v);
