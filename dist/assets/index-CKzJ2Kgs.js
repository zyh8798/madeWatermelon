(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();const O=window.PIXI,f=1408;let F=704;const{innerWidth:N,innerHeight:X}=window;X>N*1.3&&(F=f*N/X,F<320&&(F=320));const c=F,a=35,L=1/120,I=10,R=10,h=[{name:"/fruits/fruit_1.png",radius:26,imgRadius:26},{name:"/fruits/fruit_2.png",radius:39,imgRadius:39},{name:"/fruits/fruit_3.png",radius:54,imgRadius:54},{name:"/fruits/fruit_4.png",radius:59.5,imgRadius:59.5},{name:"/fruits/fruit_5.png",radius:76,imgRadius:76},{name:"/fruits/fruit_6.png",radius:91.5,imgRadius:91.5},{name:"/fruits/fruit_7.png",radius:100,imgRadius:93},{name:"/fruits/fruit_8.png",radius:115,imgRadius:129},{name:"/fruits/fruit_9.png",radius:130,imgRadius:154},{name:"/fruits/fruit_10.png",radius:140,imgRadius:151},{name:"/fruits/fruit_11.png",radius:150,imgRadius:202}],x=new O.Application({width:c,height:f,antialias:!0,backgroundColor:16771229}),l=window.b2,{Sprite:j,Loader:C}=O,m=new l.World({x:0,y:10}),k=()=>{const i=new l.BodyDef,t=new l.FixtureDef;i.type=l.staticBody,t.density=0,t.friction=.2,t.restitution=.3,t.filter.groupIndex=-20,t.shape=new l.ChainShape().CreateLoop([{x:0,y:0/a},{x:0,y:f/a},{x:c/a,y:f/a},{x:c/a,y:0/a}]);const e=m.CreateBody(i);e.CreateFixture(t),e.SetUserData({type:-1})},M=150/a,G=new l.BodyDef;G.type=l.dynamicBody;G.position.Set(c/2/a,M);const _=h.map((i,t)=>{const e=new l.FixtureDef;return e.density=.1,e.friction=.2,e.restitution=.3,e.shape=new l.CircleShape(i.radius/a),e.filter.groupIndex=1,e});let p=0;const d={},S=new Map,g=new Set,D=(i,t=-299,e=-299)=>{const n=h[i],r=new j;return r.anchor.set(.5),r.x=t,r.y=e,r.texture=C.shared.resources[n.name].texture,r.scale.set(n.radius/n.imgRadius),r},s={current:0,next:0};let y,E;const q=()=>{let i=0,t=0;Object.defineProperty(s,"current",{get(){return i},set(e){i=e;const n=h[e];y.texture=C.shared.resources[n.name].texture,y.scale.set(n.radius/n.imgRadius)}}),Object.defineProperty(s,"next",{get(){return t},set(e){t=e;const n=h[e];E.texture=C.shared.resources[n.name].texture,E.scale.set(n.radius/n.imgRadius)}})};q();const $=(i,t=c/2)=>{let e=t;t<5&&(e=5),t>c-5&&(e=c-5);const n=m.CreateBody(G);n.SetSleepingAllowed(!0),n.SetPositionXY(e/a,M),n.CreateFixture(_[i]),n.SetUserData({type:i,id:p});const r=D(i);x.stage.addChild(r),d[p++]={body:n,sprite:r},s.current=s.next,p<4?s.next=Math.floor(Math.random()*2):p<8?s.next=Math.floor(Math.random()*3):p<16?s.next=Math.round(Math.random()*3.5):s.next=Math.round(Math.random()*4)},P=()=>{S.forEach((i,t)=>{let e=d[i],n=d[t];if(e.body.GetPosition().y>n.body.GetPosition().y){const u=e;e=n,n=u}n.body.DestroyFixture(n.body.GetFixtureList());const r=n.body.GetUserData();n.body.CreateFixture(_[r.type+1]),n.body.SetUserData({...r,type:r.type+1}),g.delete(t),g.delete(i),delete d[e.body.GetUserData().id],m.DestroyBody(e.body),x.stage.removeChild(e.sprite);const o=h[r.type+1];n.sprite.texture=C.shared.resources[o.name].texture,n.sprite.scale.set(o.radius/o.imgRadius)}),S.clear()},v=()=>{m.Step(L,I,R),P(),m.Step(L,I,R),P(),m.Step(L,I,R),P(),Object.keys(d).forEach(i=>{const t=d[i],{body:e,sprite:n}=t,{x:r,y:o}=e.GetPosition(),u=e.GetAngle();n.x=r*a,n.y=o*a,n.rotation=u}),requestAnimationFrame(v)},B=document.getElementById("root");let A=0;const U=()=>{const i=new Date().getTime();return i-A<100?!0:(A=i,!1)},H=()=>{const i=document.getElementsByTagName("canvas")[0];i.addEventListener("touchmove",t=>{const{changedTouches:e}=t;if(e.length!==1)return;const n=parseFloat(getComputedStyle(B).marginLeft),{clientX:r}=e[0],o=(r-n)/parseFloat(B.childNodes[0].style.transform.slice(6));y.x=o}),i.addEventListener("touchend",t=>{if(U())return;const{changedTouches:e}=t;if(e.length!==1)return;const n=parseFloat(getComputedStyle(B).marginLeft),{clientX:r}=e[0],o=(r-n)/parseFloat(B.childNodes[0].style.transform.slice(6));y.x=c/2,$(s.current,o)}),i.addEventListener("mousemove",t=>{if("ontouchend"in window)return;const{offsetX:e}=t;y.x=e}),i.addEventListener("click",t=>{if("ontouchend"in window||U())return;const{offsetX:e}=t;y.x=e,$(s.current,e)}),k(),y=D(s.current,c/2,M*a),E=D(s.next,c/2,0),x.stage.addChild(y),x.stage.addChild(E),l.ContactListener.prototype.PreSolve=t=>{const e=t.GetFixtureA().GetBody().GetUserData(),n=t.GetFixtureB().GetBody().GetUserData();if(e.type!==n.type||e.type>=10)return;const r=Math.min(e.id,n.id),o=Math.max(e.id,n.id),u=S.get(r);if(!u){if(g.has(r)||g.has(o))return;S.set(r,o),g.add(r),g.add(o),t.SetEnabled(!1);return}u===o&&t.SetEnabled(!1)},v()},Y=()=>{const i={fruits:Object.keys(d).map(t=>{const e=d[t],n=e.body.GetPosition();return{id:parseInt(t),type:e.body.GetUserData().type,x:n.x,y:n.y,angle:e.body.GetAngle()}}),fruitId:p,currentFruit:s.current,nextFruit:s.next};localStorage.setItem("watermelonGame",JSON.stringify(i))},z=()=>{const i=localStorage.getItem("watermelonGame");if(i)try{const t=JSON.parse(i);T(),t.fruits.forEach(e=>{const n=h[e.type],r=m.CreateBody(G);r.SetSleepingAllowed(!0),r.SetPositionXY(e.x,e.y),r.SetAngle(e.angle),r.CreateFixture(_[e.type]),r.SetUserData({type:e.type,id:e.id});const o=D(e.type);o.x=e.x*a,o.y=e.y*a,o.rotation=e.angle,x.stage.addChild(o),d[e.id]={body:r,sprite:o}}),p=t.fruitId,s.current=t.currentFruit,s.next=t.nextFruit}catch(t){console.error("加载游戏失败:",t)}},T=()=>{Object.keys(d).forEach(i=>{const t=d[i];m.DestroyBody(t.body),x.stage.removeChild(t.sprite),delete d[i]}),S.clear(),g.clear(),p=0,s.current=0,s.next=0},{Loader:J}=O,K=h.map(i=>i.name),w=document.getElementById("root"),b=x.view;w.appendChild(b);J.shared.add(K).load(H);const W=()=>{const{innerWidth:i,innerHeight:t}=window;document.body.style.height=`${t}px`,i/t>c/f?(w.style.height=`${t}px`,w.style.width=`${t/f*c}px`,b.style.transform=`scale(${t/f})`):(w.style.width=`${i}px`,w.style.height=`${i/c*f}px`,b.style.transform=`scale(${i/c})`)};b.style.width=`${c}px`;b.style.height=`${f}px`;W();window.onresize=W;document.getElementById("saveBtn")?.addEventListener("click",Y);document.getElementById("loadBtn")?.addEventListener("click",z);document.getElementById("clearBtn")?.addEventListener("click",T);
