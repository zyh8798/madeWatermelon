(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();const R=window.PIXI,m=1408;let D=704;const{innerWidth:U,innerHeight:_}=window;_>U*1.3&&(D=m*U/_,D<320&&(D=320));const d=D,a=35,G=1/120,I=10,v=10,h=[{name:"/madeWatermelon/fruits/fruit_1.png",radius:26,imgRadius:26},{name:"/madeWatermelon/fruits/fruit_2.png",radius:39,imgRadius:39},{name:"/madeWatermelon/fruits/fruit_3.png",radius:54,imgRadius:54},{name:"/madeWatermelon/fruits/fruit_4.png",radius:59.5,imgRadius:59.5},{name:"/madeWatermelon/fruits/fruit_5.png",radius:76,imgRadius:76},{name:"/madeWatermelon/fruits/fruit_6.png",radius:91.5,imgRadius:91.5},{name:"/madeWatermelon/fruits/fruit_7.png",radius:100,imgRadius:93},{name:"/madeWatermelon/fruits/fruit_8.png",radius:115,imgRadius:129},{name:"/madeWatermelon/fruits/fruit_9.png",radius:130,imgRadius:154},{name:"/madeWatermelon/fruits/fruit_10.png",radius:140,imgRadius:151},{name:"/madeWatermelon/fruits/fruit_11.png",radius:150,imgRadius:202}],x=new R.Application({width:d,height:m,antialias:!0,backgroundColor:16771229}),u=window.b2,{Sprite:T,Loader:E}=R,y=new u.World({x:0,y:10}),q=()=>{const r=new u.BodyDef,t=new u.FixtureDef;r.type=u.staticBody,t.density=0,t.friction=.2,t.restitution=.3,t.filter.groupIndex=-20,t.shape=new u.ChainShape().CreateLoop([{x:0,y:0/a},{x:0,y:m/a},{x:d/a,y:m/a},{x:d/a,y:0/a}]);const e=y.CreateBody(r);e.CreateFixture(t),e.SetUserData({type:-1})},O=150/a,W=new u.BodyDef;W.type=u.dynamicBody;W.position.Set(d/2/a,O);const M=h.map((r,t)=>{const e=new u.FixtureDef;return e.density=.1,e.friction=.2,e.restitution=.3,e.shape=new u.CircleShape(r.radius/a),e.filter.groupIndex=1,e});let p=0;const c={},S=new Map,g=new Set,F=(r,t=-299,e=-299)=>{const o=h[r],n=new T;return n.anchor.set(.5),n.x=t,n.y=e,n.texture=E.shared.resources[o.name].texture,n.scale.set(o.radius/o.imgRadius),n},s={current:0,next:0};let f,L;const H=()=>{let r=0,t=0;Object.defineProperty(s,"current",{get(){return r},set(e){r=e;const o=h[e];f.texture=E.shared.resources[o.name].texture,f.scale.set(o.radius/o.imgRadius)}}),Object.defineProperty(s,"next",{get(){return t},set(e){t=e;const o=h[e];L.texture=E.shared.resources[o.name].texture,L.scale.set(o.radius/o.imgRadius)}})};H();const N=(r,t=d/2)=>{let e=t;t<5&&(e=5),t>d-5&&(e=d-5);const o=y.CreateBody(W);o.SetSleepingAllowed(!0),o.SetPositionXY(e/a,O),o.CreateFixture(M[r]),o.SetUserData({type:r,id:p});const n=F(r);x.stage.addChild(n),c[p++]={body:o,sprite:n},s.current=s.next,p<4?s.next=Math.floor(Math.random()*2):p<8?s.next=Math.floor(Math.random()*3):p<16?s.next=Math.round(Math.random()*3.5):s.next=Math.round(Math.random()*4)},P=()=>{S.forEach((r,t)=>{let e=c[r],o=c[t];if(e.body.GetPosition().y>o.body.GetPosition().y){const l=e;e=o,o=l}o.body.DestroyFixture(o.body.GetFixtureList());const n=o.body.GetUserData();o.body.CreateFixture(M[n.type+1]),o.body.SetUserData({...n,type:n.type+1}),g.delete(t),g.delete(r),delete c[e.body.GetUserData().id],y.DestroyBody(e.body),x.stage.removeChild(e.sprite);const i=h[n.type+1];o.sprite.texture=E.shared.resources[i.name].texture,o.sprite.scale.set(i.radius/i.imgRadius)}),S.clear()},A=()=>{y.Step(G,I,v),P(),y.Step(G,I,v),P(),y.Step(G,I,v),P(),Object.keys(c).forEach(r=>{const t=c[r],{body:e,sprite:o}=t,{x:n,y:i}=e.GetPosition(),l=e.GetAngle();o.x=n*a,o.y=i*a,o.rotation=l}),requestAnimationFrame(A)},B=document.getElementById("root");let X=0;const $=()=>{const r=new Date().getTime();return r-X<100?!0:(X=r,!1)},Y=()=>{const r=document.getElementsByTagName("canvas")[0];r.addEventListener("touchmove",t=>{const{changedTouches:e}=t;if(e.length!==1)return;const o=parseFloat(getComputedStyle(B).marginLeft),{clientX:n}=e[0],i=(n-o)/parseFloat(B.childNodes[0].style.transform.slice(6));f.x=i}),r.addEventListener("touchend",t=>{if($())return;const{changedTouches:e}=t;if(e.length!==1)return;const o=parseFloat(getComputedStyle(B).marginLeft),{clientX:n}=e[0],i=(n-o)/parseFloat(B.childNodes[0].style.transform.slice(6));f.x=d/2,N(s.current,i)}),r.addEventListener("mousemove",t=>{if("ontouchend"in window)return;const{offsetX:e}=t;f.x=e}),r.addEventListener("click",t=>{if("ontouchend"in window||$())return;const{offsetX:e}=t;f.x=e,N(s.current,e)}),q(),f=F(s.current,d/2,O*a),L=F(s.next,d/2,0),x.stage.addChild(f),x.stage.addChild(L),u.ContactListener.prototype.PreSolve=t=>{const e=t.GetFixtureA().GetBody().GetUserData(),o=t.GetFixtureB().GetBody().GetUserData();if(e.type!==o.type||e.type>=10)return;const n=Math.min(e.id,o.id),i=Math.max(e.id,o.id),l=S.get(n);if(!l){if(g.has(n)||g.has(i))return;S.set(n,i),g.add(n),g.add(i),t.SetEnabled(!1);return}l===i&&t.SetEnabled(!1)},A()},z=()=>{const r={fruits:Object.keys(c).map(t=>{const e=c[t],o=e.body.GetPosition();return{id:parseInt(t),type:e.body.GetUserData().type,x:o.x,y:o.y,angle:e.body.GetAngle()}}),fruitId:p,currentFruit:s.current,nextFruit:s.next};localStorage.setItem("watermelonGame",JSON.stringify(r))},J=()=>{const r=localStorage.getItem("watermelonGame");if(r)try{const t=JSON.parse(r);k(),t.fruits.forEach(e=>{const o=h[e.type],n=y.CreateBody(W);n.SetSleepingAllowed(!0),n.SetPositionXY(e.x,e.y),n.SetAngle(e.angle),n.CreateFixture(M[e.type]),n.SetUserData({type:e.type,id:e.id});const i=F(e.type);i.x=e.x*a,i.y=e.y*a,i.rotation=e.angle,x.stage.addChild(i),c[e.id]={body:n,sprite:i}}),p=t.fruitId,s.current=t.currentFruit,s.next=t.nextFruit}catch(t){console.error("加载游戏失败:",t)}},k=()=>{Object.keys(c).forEach(r=>{const t=c[r];y.DestroyBody(t.body),x.stage.removeChild(t.sprite),delete c[r]}),S.clear(),g.clear(),p=0,s.current=0,s.next=0};"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/madeWatermelon/sw.js").then(r=>{console.log("SW registered: ",r)}).catch(r=>{console.log("SW registration failed: ",r)})});let C;window.addEventListener("beforeinstallprompt",r=>{r.preventDefault(),C=r;const t=document.getElementById("installBtn");t&&(t.style.display="block",t.addEventListener("click",()=>{C.prompt(),C.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt"),C=null,t&&(t.style.display="none")})}))});const{Loader:K}=R,V=h.map(r=>r.name),w=document.getElementById("root"),b=x.view;w.appendChild(b);K.shared.add(V).load(Y);const j=()=>{const{innerWidth:r,innerHeight:t}=window;document.body.style.height=`${t}px`,r/t>d/m?(w.style.height=`${t}px`,w.style.width=`${t/m*d}px`,b.style.transform=`scale(${t/m})`):(w.style.width=`${r}px`,w.style.height=`${r/d*m}px`,b.style.transform=`scale(${r/d})`)};b.style.width=`${d}px`;b.style.height=`${m}px`;j();window.onresize=j;document.getElementById("saveBtn")?.addEventListener("click",z);document.getElementById("loadBtn")?.addEventListener("click",J);document.getElementById("clearBtn")?.addEventListener("click",k);
