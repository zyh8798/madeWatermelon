(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();const O=window.PIXI,m=1408;let D=704;const{innerWidth:U,innerHeight:_}=window;_>U*1.3&&(D=m*U/_,D<320&&(D=320));const d=D,a=35,I=1/120,W=10,P=10,h=[{name:"/madeWatermelon/fruits/fruit_1.png",radius:26,imgRadius:26},{name:"/madeWatermelon/fruits/fruit_2.png",radius:39,imgRadius:39},{name:"/madeWatermelon/fruits/fruit_3.png",radius:54,imgRadius:54},{name:"/madeWatermelon/fruits/fruit_4.png",radius:59.5,imgRadius:59.5},{name:"/madeWatermelon/fruits/fruit_5.png",radius:76,imgRadius:76},{name:"/madeWatermelon/fruits/fruit_6.png",radius:91.5,imgRadius:91.5},{name:"/madeWatermelon/fruits/fruit_7.png",radius:100,imgRadius:93},{name:"/madeWatermelon/fruits/fruit_8.png",radius:115,imgRadius:129},{name:"/madeWatermelon/fruits/fruit_9.png",radius:130,imgRadius:154},{name:"/madeWatermelon/fruits/fruit_10.png",radius:140,imgRadius:151},{name:"/madeWatermelon/fruits/fruit_11.png",radius:150,imgRadius:202}],x=new O.Application({width:d,height:m,antialias:!0,backgroundColor:16771229}),l=window.b2,{Sprite:j,Loader:F}=O,y=new l.World({x:0,y:10}),q=()=>{const o=new l.BodyDef,t=new l.FixtureDef;o.type=l.staticBody,t.density=0,t.friction=.2,t.restitution=.3,t.filter.groupIndex=-20,t.shape=new l.ChainShape().CreateLoop([{x:0,y:0/a},{x:0,y:m/a},{x:d/a,y:m/a},{x:d/a,y:0/a}]);const e=y.CreateBody(o);e.CreateFixture(t),e.SetUserData({type:-1})},M=150/a,G=new l.BodyDef;G.type=l.dynamicBody;G.position.Set(d/2/a,M);const v=h.map((o,t)=>{const e=new l.FixtureDef;return e.density=.1,e.friction=.2,e.restitution=.3,e.shape=new l.CircleShape(o.radius/a),e.filter.groupIndex=1,e});let p=0;const c={},S=new Map,g=new Set,E=(o,t=-299,e=-299)=>{const n=h[o],r=new j;return r.anchor.set(.5),r.x=t,r.y=e,r.texture=F.shared.resources[n.name].texture,r.scale.set(n.radius/n.imgRadius),r},s={current:0,next:0};let f,L;const H=()=>{let o=0,t=0;Object.defineProperty(s,"current",{get(){return o},set(e){o=e;const n=h[e];f.texture=F.shared.resources[n.name].texture,f.scale.set(n.radius/n.imgRadius)}}),Object.defineProperty(s,"next",{get(){return t},set(e){t=e;const n=h[e];L.texture=F.shared.resources[n.name].texture,L.scale.set(n.radius/n.imgRadius)}})};H();const N=(o,t=d/2)=>{let e=t;t<5&&(e=5),t>d-5&&(e=d-5);const n=y.CreateBody(G);n.SetSleepingAllowed(!0),n.SetPositionXY(e/a,M),n.CreateFixture(v[o]),n.SetUserData({type:o,id:p});const r=E(o);x.stage.addChild(r),c[p++]={body:n,sprite:r},s.current=s.next,p<4?s.next=Math.floor(Math.random()*2):p<8?s.next=Math.floor(Math.random()*3):p<16?s.next=Math.round(Math.random()*3.5):s.next=Math.round(Math.random()*4)},R=()=>{S.forEach((o,t)=>{let e=c[o],n=c[t];if(e.body.GetPosition().y>n.body.GetPosition().y){const u=e;e=n,n=u}n.body.DestroyFixture(n.body.GetFixtureList());const r=n.body.GetUserData();n.body.CreateFixture(v[r.type+1]),n.body.SetUserData({...r,type:r.type+1}),g.delete(t),g.delete(o),delete c[e.body.GetUserData().id],y.DestroyBody(e.body),x.stage.removeChild(e.sprite);const i=h[r.type+1];n.sprite.texture=F.shared.resources[i.name].texture,n.sprite.scale.set(i.radius/i.imgRadius)}),S.clear()},A=()=>{y.Step(I,W,P),R(),y.Step(I,W,P),R(),y.Step(I,W,P),R(),Object.keys(c).forEach(o=>{const t=c[o],{body:e,sprite:n}=t,{x:r,y:i}=e.GetPosition(),u=e.GetAngle();n.x=r*a,n.y=i*a,n.rotation=u}),requestAnimationFrame(A)},B=document.getElementById("root");let X=0;const $=()=>{const o=new Date().getTime();return o-X<100?!0:(X=o,!1)},Y=()=>{const o=document.getElementsByTagName("canvas")[0];o.addEventListener("touchmove",t=>{const{changedTouches:e}=t;if(e.length!==1)return;const n=parseFloat(getComputedStyle(B).marginLeft),{clientX:r}=e[0],i=(r-n)/parseFloat(B.childNodes[0].style.transform.slice(6));f.x=i}),o.addEventListener("touchend",t=>{if($())return;const{changedTouches:e}=t;if(e.length!==1)return;const n=parseFloat(getComputedStyle(B).marginLeft),{clientX:r}=e[0],i=(r-n)/parseFloat(B.childNodes[0].style.transform.slice(6));f.x=d/2,N(s.current,i)}),o.addEventListener("mousemove",t=>{if("ontouchend"in window)return;const{offsetX:e}=t;f.x=e}),o.addEventListener("click",t=>{if("ontouchend"in window||$())return;const{offsetX:e}=t;f.x=e,N(s.current,e)}),q(),f=E(s.current,d/2,M*a),L=E(s.next,d/2,0),x.stage.addChild(f),x.stage.addChild(L),l.ContactListener.prototype.PreSolve=t=>{const e=t.GetFixtureA().GetBody().GetUserData(),n=t.GetFixtureB().GetBody().GetUserData();if(e.type!==n.type||e.type>=10)return;const r=Math.min(e.id,n.id),i=Math.max(e.id,n.id),u=S.get(r);if(!u){if(g.has(r)||g.has(i))return;S.set(r,i),g.add(r),g.add(i),t.SetEnabled(!1);return}u===i&&t.SetEnabled(!1)},A()},z=()=>{const o={fruits:Object.keys(c).map(t=>{const e=c[t],n=e.body.GetPosition();return{id:parseInt(t),type:e.body.GetUserData().type,x:n.x,y:n.y,angle:e.body.GetAngle()}}),fruitId:p,currentFruit:s.current,nextFruit:s.next};localStorage.setItem("watermelonGame",JSON.stringify(o))},J=()=>{const o=localStorage.getItem("watermelonGame");if(o)try{const t=JSON.parse(o);k(),t.fruits.forEach(e=>{const n=h[e.type],r=y.CreateBody(G);r.SetSleepingAllowed(!0),r.SetPositionXY(e.x,e.y),r.SetAngle(e.angle),r.CreateFixture(v[e.type]),r.SetUserData({type:e.type,id:e.id});const i=E(e.type);i.x=e.x*a,i.y=e.y*a,i.rotation=e.angle,x.stage.addChild(i),c[e.id]={body:r,sprite:i}}),p=t.fruitId,s.current=t.currentFruit,s.next=t.nextFruit}catch(t){console.error("加载游戏失败:",t)}},k=()=>{Object.keys(c).forEach(o=>{const t=c[o];y.DestroyBody(t.body),x.stage.removeChild(t.sprite),delete c[o]}),S.clear(),g.clear(),p=0,s.current=0,s.next=0};let C;window.addEventListener("beforeinstallprompt",o=>{o.preventDefault(),C=o;const t=document.getElementById("installBtn");t&&(t.style.display="block",t.addEventListener("click",()=>{C.prompt(),C.userChoice.then(e=>{e.outcome==="accepted"?console.log("User accepted the install prompt"):console.log("User dismissed the install prompt"),C=null,t&&(t.style.display="none")})}))});const{Loader:K}=O,V=h.map(o=>o.name),w=document.getElementById("root"),b=x.view;w.appendChild(b);K.shared.add(V).load(Y);const T=()=>{const{innerWidth:o,innerHeight:t}=window;document.body.style.height=`${t}px`,o/t>d/m?(w.style.height=`${t}px`,w.style.width=`${t/m*d}px`,b.style.transform=`scale(${t/m})`):(w.style.width=`${o}px`,w.style.height=`${o/d*m}px`,b.style.transform=`scale(${o/d})`)};b.style.width=`${d}px`;b.style.height=`${m}px`;T();window.onresize=T;document.getElementById("saveBtn")?.addEventListener("click",z);document.getElementById("loadBtn")?.addEventListener("click",J);document.getElementById("clearBtn")?.addEventListener("click",k);
